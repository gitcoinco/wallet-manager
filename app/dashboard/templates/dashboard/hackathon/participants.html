{% comment %}
    Copyright (C) 2019 Gitcoin Core

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as published
    by the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program. If not, see <http://www.gnu.org/licenses/>.

{% endcomment %}
{% load i18n static email_obfuscator add_url_schema avatar_tags %}
<!DOCTYPE html>
<html lang="en">

<head>
    {% include 'shared/head.html' %}
    {% include 'shared/cards.html' %}
    <link rel="stylesheet" href={% static "v2/css/dashboard.css" %}>
    <link rel="stylesheet" href={% static "v2/css/users.css" %}/>
    <link rel="stylesheet" href={% static "v2/css/tag.css" %}/>
    <link rel="stylesheet" href={% static "v2/css/rating.css" %}/>
    <link rel="stylesheet" href={% static "v2/css/hackathons/explorer.css" %}>
    <link rel="stylesheet" href={% static "v2/css/sidebar_search.css" %}>
    <style>
        @media screen and (max-width: 767.98px) {
            .hackathon-banner {
                height: 8em !important;
            }

            .navigation {
                margin: 0px !important;
            }
        }

        .hackathon-banner {
            background: {% firstof hackathon.background_color or 'white' %};
            color: {% firstof hackathon.text_color or 'black' %};
            height: 225px;
            background-image: url({{ hackathon.banner.url|default:"/static/wallpapers/V3.png" }});
        }

        .hackathon-text {
            color: white;
        }

        .hackathon-title {
            font-size: 1.4rem;
        }

        .hackathon-countdown {
            font-size: 1rem;
        }

        .navigation {
            height: 60px;
            display: flex;
            align-items: center;
            box-shadow: 0px 1px 4px -3px rgba(0, 0, 0, 0.75);
            margin-bottom: 2px;

        }

        .navigation a {
            font-weight: 500;
            padding: 0;
        }

        .navigation a.active {
            font-weight: bold;
            color: #0b0d9d;
            border-bottom: 4px solid #0b0d9d;
        }

        .hackathon-logo {
            margin-top: -225px;
            height: 185px;
            max-height: 185px;
            width: 100%;
            max-width: 100%;
            background-color: #090E60;
            border-radius: 10px;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .hackathon-logo img {
            height: 115px;
        }

        @media screen and (max-width: 767.98px) {
            .logo-container {
                display: none;
            }
        }

        .register {
            width: 100%;
        }

        .left-ribbon {
            border-left: 3px solid var(--gc-blue);
            padding-left: 6px !important;
        }
    </style>
</head>

<body class="interior {{ active }} g-font-muli">
{% include 'shared/tag_manager_2.html' %}
<div class="container-fluid header sticky-top dash">
    {% include 'shared/top_nav.html' with class='d-md-flex' %}
    {% include 'shared/nav_hackathons.html' %}
</div>
<div id="{{ hackathon.identifier }}"
     class="d-flex justify-content-between flex-column flex-md-row align-items-center p-3 banner hackathon-banner">
    <div class="offset-2 hackathon-text pl-4">
        <div class="">
            <p class="hackathon-title title font-weight-bold mb-0">GITCOIN VIRTUAL HACKATHON</p>
        </div>
        <p class="mb-1">
            {% if hackathon.end_date|timeuntil >= "1 min" %}
                <small class="hackathon-countdown text-uppercase">Ends in {{ hackathon.end_date|timeuntil }}</small>
            {% endif %}
        </p>
    </div>
</div>

<div class="navigation">
    <div class="offset-2"></div>
    <a href="{% url 'hackathon' hackathon.slug %}" class=" btn ml-2 mr-4">
        Prizes {% if total_prizes %}({{ total_prizes }}){% endif %}
    </a>
    {% if hackathon.town_square_link %}
        <a href="/{{ hackathon.town_square_link }}" class="btn mr-4">
            SW3 Town Square
        </a>
    {% endif %}


    <a href="#" class="btn mr-4 active">
        Participants{% if total_participants %} ({{ total_participants }}){% endif %}
    </a>

    {% if hackathon.show_results %}
        <a href="{% url 'hackathon_projects' hackathon.slug %}" class="btn mr-4">
            Projects {% if total_projects %}({{ total_projects }}){% endif %}
        </a>
    {% endif %}
    {% if hackathon.end_date|timesince <= "1 min" %}
        <a href="{% url 'hackathon_onboard' hackathon.slug %}" class="btn mr-3">Guide</a>
    {% endif %}
</div>

<div id="gc-hackathon-participants"  class="container-fluid no-gutter">
    <div class="row">
        <div class="col-12 col-lg-3 col-xl-2" id="sidebar_container" style="background: #F2F6F9;">
            <div class="sidebar_search font-body">
                <form>
                    <div class="col logo-container">
                        <div class="hackathon-logo mb-1">
                            {% if hackathon.logo_svg %}
                                <img class="d-none d-md-block mx-auto mb-5 mw-100" src="{{ hackathon.logo_svg.url }}"
                                     alt="Hackathon logo"/>
                            {% elif hackathon.logo %}
                                <img class="d-none d-md-block mx-auto mb-1 mw-100" src="{{ hackathon.logo.url }}"
                                     alt="Hackathon logo"/>
                            {% endif %}
                            <small>{{ hackathon.start_date|date:"M j, Y" }}
                                - {{ hackathon.end_date|date:"M j, Y" }}</small>
                        </div>
                        <a href="{% url 'hackathon_onboard' hackathon.slug %}"
                           class="btn btn-gc-blue register col-xs-12 mt-4 mb-2">
                            Register
                        </a>
                    </div>
                    <div class="col">
                        <div class="col-12 subheading left-ribbon">
                            {% trans "Filter participants" %}
                        </div>
                        <div class="col-12 options" id="list-orgs">
                          {% if display_filters %}
                            <div class="form__radio option mb-2">
                                <input name="org" id="any_org" type="radio" value="any" checked="">
                                <label class="filter-label" for="any_org">All</label>
                            </div>
                            <div class="form__radio option mb-2">
                                <input name="org" id="team_member" type="radio" value="team-member">
                                <label class="filter-label" for="team_member">Looking for team member</label>
                            </div>
                            <div class="form__radio option mb-2">
                                <input name="org" id="team" type="radio" value="team">
                                <label class="filter-label" for="team">Looking for a team</label>
                            </div>
                            <div class="form__radio option mb-2">
                                <input name="org" id="hack" type="radio" value="hack">
                                <label class="filter-label" for="hack">Ready to hack</label>
                            </div>
                          {% endif %}
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="col-10 col-lg-8 col-xl-10 body px-4 px-lg-0 pr-lg-5 hackathon-explorer">
            <div class="container-fluid p-2" id="bounties">
                <div v-cloak>
                    <div class="sidebar-container flex-column flex-lg-row">
                        <div class="container" @scroll.passive="onScroll($event)">
                            <div class="py-5">
                                <div v-if="noResults" class="text-center">
                                    <img src="{% static 'v2/images/shrug_bot.png' %}" alt="nothing found" width="316"
                                         height="221">
                                    <p class="mt-4 font-weight-bold mb-0">No users found</p>
                                    <button class="btn blue" @click="params = {}; searchUsers()">Reset Filters</button>
                                </div>
                                <div class="grid-4" style="grid-gap: 5rem 2rem;">
                                    <div v-for="user in users" class="card card-user shadow-sm border-0" :key="user.id">
                                        <div class="d-flex flex-column py-1 bg-lightblue">
                                            <a :href="`/profile/${ user.handle }`" class="mx-auto">
                                                <img class="rounded-circle shadow-sm mt-n4 mb-2 bg-white"
                                                     style="height: 5rem; width: 5rem;"
                                                     :src="`/dynamic/avatar/${ user.handle }`"
                                                     alt="${user.handle} Avatar"/>
                                            </a>
                                            <h5 class="text-center font-weight-bold font-header mb-0">
                                                [[ user.name || user.handle ]]
                                                <span v-if="user.verification">
                                                  <img src="{% static 'v2/images/badge-verify.svg' %}" width="15" height="15"
                                                       title="Verified user" alt="verify badget">
                                                </span>
                                            </h5>
                                            <a :href="`/profile/${ user.handle }`"
                                               class="text-center font-smaller-3 d-block mb-2">
                                                @[[ user.handle ]]
                                            </a>

                                            <small class="text-center font-body pb-1 mb-3"
                                                   v-if="user.status == 'looking-team'">
                                                <i class="fas fa-users mr-1 gc-text-blue"></i>Looking for a team
                                            </small>
                                            <small class="text-center font-body pb-1 mb-3"
                                                   v-else-if="user.status == 'looking-team-member'">
                                                <i class="fas fa-wrench mr-1 gc-text-blue"></i>Looking for team member
                                            </small>
                                            <small class="text-center font-body pb-1 mb-3 font-weight-semibold" v-else>
                                                <i class="fas fa-check mr-1 gc-text-blue"></i>Ready to hack
                                            </small>
                                        </div>
                                        <div class="card-body d-flex flex-column justify-content-between">

                                            <div class="text-center mt-2 info-card-desc" style="height: 60px">
                                                <p>[[ user.message ]]</p>
                                            </div>

                                            <div class="text-center mt-2 mb-2" style="height: 55px">
                                                <div v-if="user.project">
                                                    <h4 class="font-weight-bold font-smaller-1 pt-0">Projects</h4>
                                                    <a :href="`/profile/${ user.handle }`"
                                                       class="mx-auto d-flex justify-content-center">
                                                        <img class="rounded-circle bg-white mr-2"
                                                             style="height: 1.2rem; width: 1.2rem;"
                                                             :src="`/dynamic/avatar/${ user.project.logo }`"/>
                                                        <p class="font-body font-weight-semibold">[[ user.project.name
                                                            ]]</p>
                                                    </a>
                                                </div>
                                            </div>
                                            <template>
                                                <div v-if="user.keywords" class="text-center mb-1" style="height: 40px">
                                                    <template v-for="keyword in user.keywords.slice(0, 7)">
                                                        <span class="badge badge--bluelight">[[ keyword ]]</span>[[ ' '
                                                        ]]
                                                    </template>
                                                </div>
                                            </template>

                                            <div class="text-center mt-2">
                                                <!--button
                                                        class="btn btn-gc-blue font-caption font-weight-semibold"
                                                >
                                                    Send team-up request
                                                </button-->

                                                <button v-if="user.is_following" @click="joinTribe(user, $event)"
                                                  class="btn btn-gc-pink font-caption font-weight-semibold col-8"
                                                >
                                                  <i class="fas fa-user-minus mr-1"></i>
                                                  Unfollow
                                                </button>
                                                <button v-else @click="joinTribe(user, $event)"
                                                  class="btn btn-gc-blue font-caption font-weight-semibold col-8"
                                                >
                                                  <i class="fas fa-user-plus mr-1"></i>
                                                  Follow
                                                </button>
                                                <button
                                                        @click="openChat(user.handle)"
                                                        class="btn btn-outline-gc-blue font-caption font-weight-semibold"
                                                >
                                                    <i class="fas fa-comment-dots mr-1"></i>
                                                </button>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <loading-screen v-if="isLoading"></loading-screen>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script type="text/x-template" id="select2-template">
    <select>
        <slot></slot>
    </select>
</script>

{% csrf_token %}
{% include 'shared/analytics.html' %}
{% include 'shared/footer_scripts.html' %}
{% include 'shared/footer.html' %}

<script src="{% static "v2/js/vue-components.js" %}"></script>
<script src="{% static "v2/js/users.js" %}"></script>
<script>
  $('body').bootstrapTooltip({
    selector: '[data-toggle="tooltip"]'
  });
  const csrftoken = jQuery("[name=csrfmiddlewaretoken]").val();
  document.keywords = {{keywords | safe}};
  if (document.getElementById('gc-hackathon-participants')) {
    var app = new Vue({
      delimiters: ['[[', ']]'],
      el: '#gc-hackathon-participants',
      data: {
        users,
        usersPage,
        usersNumPages,
        usersHasNext,
        numUsers,
        media_url,
        searchTerm: null,
        bottom: false,
        params: {},
        funderBounties: [],
        currentBounty: undefined,
        contributorInvite: undefined,
        isFunder: false,
        bountySelected: null,
        userSelected: [],
        showModal: false,
        showFilters: !document.getElementById('explore_tribes'),
        skills: document.keywords,
        selectedSkills: [],
        noResults: false,
        isLoading: true,
        gitcoinIssueUrl: '',
        issueDetails: undefined,
        errorIssueDetails: undefined,
        showBanner: undefined,
        persona: undefined,
        hideFilterButton: !!document.getElementById('explore_tribes')
      },
      methods: {
        openChat: function(user) {
          const url = user ? `https://chat.gitcoin.co/gitcoin/messages/@${user}` : 'https://chat.gitcoin.co/';

          window.open(url, 'Loading', 'top=0,left=0,width=400,height=600,status=no,toolbar=no,location=no,menubar=no,titlebar=no');
        }
      },
      mounted() {
        this.fetchUsers(null, "{{ hackathon.slug }}");
        this.$watch('params', function (newVal, oldVal) {
          this.searchUsers();
        }, {
          deep: true
        });
      },
      created() {
        this.extractURLFilters();
      },
      beforeMount() {
        window.addEventListener('scroll', () => {
          this.bottom = this.bottomVisible();
        }, false);
      },
      beforeDestroy() {
        window.removeEventListener('scroll', () => {
          this.bottom = this.bottomVisible();
        });
      }
    });
  }

</script>
</body>
</html>
