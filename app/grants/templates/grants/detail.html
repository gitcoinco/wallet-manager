{% comment %}
  Copyright (C) 2018 Gitcoin Core

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published
  by the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program. If not, see <http://www.gnu.org/licenses/>.
{% endcomment %}
{% load static humanize i18n %}
<!DOCTYPE html>
<html lang="en">
  <head>
    {% include 'shared/head.html' %}
    {% include 'shared/cards.html' %}
    <link rel="stylesheet" href="{% static "v2/css/grants/milestones.css" %}">
  </head>
  <body class="interior {{ active }} grant grant-detail">
    {% include 'shared/tag_manager_2.html' %}
    <div class="container-fluid header dash">
      {% include 'shared/nav.html' %}
    </div>

    <img src="{% if grant.logo and grant.logo.url %}{{ grant.logo.url }}{% else %}{% static 'v2/images/bitmap.png' %}{% endif %}" width="100%" />

    <div class="grant__header">
      <div class="container">
        <div class="row">
          <div class="col-6">
            <div class="grant__specs">
              <p class="grant__profile-details">
                <img class="grant__avatar" src="{{ grant.admin_profile.avatar_url }}"> {% trans "By " %}
                <a href="{% url 'profile' grant.admin_profile.handle %}">{{ grant.admin_profile.handle }}</a>
              </p>
              <h1 class="grant__title">{{ grant.title }}</h1>

              <p class="grant__reference-url">
                <i class="fab fa-github"></i>
                <a href="{{ grant.reference_url }}" target="_blank"> {{ grant.reference_url }}</a>
              </p>

              <p class="grant__description">{{ grant.description }}</p>
            </div>
          </div>
        <div class="col-6">
          <button class="button button--primary button--full">{% trans "Fund this Project" %}</button>

          <div class="grant__progress top-buffer">
            <div class="progress">
              <div class="progress-bar" style="width:{{ grant.percent_completed }}%"></div>
            </div>

            <div class="progress-text top-buffer">
              <div class="row">
                <div class="col-6">
                  <span>{{ grant.amount_received }} ETH</span>
                  <p>Current</p>
                </div>
                <div class="col-6 text-right">
                  <span>{{ grant.amount_goal }} ETH</span>
                  <p>Goal</p>
                </div>
              </div>
            </div>
          </div>

          <div class="grant__stakeholders">
            <p>{% trans "Supported by" %}</p>
            <div class="grant__stakeholders-list">
              {% for subscriber in grant.subscriptions.all %}
                <a class="grant__stakeholders-item" href="{% url 'profile' subscriber.contributor_profile.handle %}">
                  <img src="{{ subscriber.contributor_profile.avatar_url }}" />
                </a>
              {% empty %}
                <a href="{% url 'grants:fund' grant.id %}">{% trans "No active subscriptions! Subscribe now!" %}</a>
              {% endfor %}
            </div>
          </div>
        </div>
        </div>
      </div>
    </div>

    <div class="container top-buffer">
      <div class="row">
        <div class="col-8">
          <div id="tabs">
            <ul>
              <li><a href="#all-updates">{% trans "Updates" %}</a></li>
              <li><a href="#github">{% trans "GitHub" %}</a></li>
            </ul>
            {% if is_admin %}
            <div id="addUpdate" class="top-buffer">
              <form method="POST" id="js-postUpdate">
                {% csrf_token %}
                <div class="form__group-horizontal">
                  <input class="form__input" type="text" id="input-title" name="input-title" placeholder="{% trans 'Title' %}" required />
                </div>

                <div class="form__group-horizontal">
                  <textarea class="form__input" type="text" id="input-description" name="description" placeholder="{% trans 'Describe the update' %}" required></textarea>
                </div>

                <div class="text-right">
                  <button class="button button--primary">{% trans "Post Update" %}</button>
                </div>
              </form>
            </div>
            {% endif %}
            <div id="all-updates">
              <ul>
                {% for item in activity %}
                  <li>
                    <div class="article-title">{{ item.title }}</div>
                    <div class="article-date">{{ item.date }}</div>
                    <p class="article-description">{{ item.description }}</p>
                  </li>
                {% empty %}
                  {% trans "No updates yet!" %}
                {% endfor %}
              </ul>
            </div>
            <div id="github">
              <ul>
                {% for item in gh_activity %}
                  <li>
                    <div class="article-title">{{ item.title }}</div>
                    <div class="article-date">{{ item.date }}</div>
                    <p class="article-description">{{ item.description }}</p>
                  </li>
                {% empty %}
                  {% trans "No Github activity yet!" %}
                {% endfor %}
              </ul>
            </div>
          </div>
        </div>

        <div class="col-4">
          <p>
            {% trans "Milestones" %}
            {% if is_admin %}<a href="{% url 'grants:milestones' grant.id %}" class="milestones-edit">{% trans "Edit Milestones" %}</a>{% endif %}
          </p>
          <div class="milestones-container">
              {% if milestones %}
              <ul class="milestones-list">
                {% for milestone in milestones %}
                  <li>
                    <div class="milestone-title">{{ milestone.title }}</div>
                    <div class="milestone-date">
                      {{ milestone.due_date }} -
                      {% if milestone.completion_date %}
                        {{ milestone.completion_date }}
                      {% else %}
                        {% trans "Present" %}
                      {% endif %}
                    </div>
                    <p class="milestone-description">{{ milestone.description }}</p>
                  </li>
                {% endfor %}
              </ul>
            {% else %}
              <p>{% trans "No milestones currently set for this grant." %}</p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    {% include 'shared/bottom_notification.html' %}
    {% include 'shared/analytics.html' %}
    {% include 'shared/footer_scripts.html' %}
    {% include 'shared/footer.html' %}
  </body>

  <script src="{% static "v2/js/abi.js" %}"></script>
  <script src="{% static "v2/js/shared.js" %}"></script>
  <script src="{% static "v2/js/ipfs-api.js" %}"></script>
  <script src="{% static "v2/js/ipfs.js" %}"></script>
  <script src="{% static "v2/js/grants/detail.js" %}"></script>
</html>
