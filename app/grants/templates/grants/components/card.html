  {% comment %}
  Copyright (C) 2020 Gitcoin Core

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published
  by the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program. If not, see <http://www.gnu.org/licenses/>.
{% endcomment %}
{% load i18n static humanize grants_extra %}
<grant-card inline-template :grant="grant" :cred="credentials" :view="view" :short="shortView"
            :contributions='contributions' :show_contributions="show_contributions">
  <template>
    <div v-if="view == 'list'">
      <div class="grant-item grant-item--list flex-md-row flex-column" >
        <div class="grant-item__img col-md-1 d-md-block d-none my-auto">
          <img :src="grant.logo_url" />
        </div>
        <div class="grant-item__content col-md-8 px-3">
          <h2 class="grant-item__title font-subheader">
            <a :href="grant.details_url">[[ grant.title.slice(0,60) ]][[ grant.title.length > 60 ? '...' : '']]</a>
          </h2>
          <div>
            <p class="text-muted font-smaller-5 mb-0" style="height:2rem;"  data-toggle="tooltip" data-placement="top" title="The last time the grant admin updated the grant." >
              <i style="width: 14px;" class="fas fa-clock mt-2 mb-0 text-center"></i>
              Last Update: [[ grant.last_update ?  grant.last_update_natural : `Before Round` ]]
              <template v-if="cred.is_staff">
                <span class="ml-3" >
                  <i class="fa fa-lock" aria-hidden="true"></i> SybilScore ™️: [[ grant.sybil_score ]]
                  <span class="mx-2">|</span> RiskScore ™️: [[ grant.weighted_risk_score ]]
                </span>
              </template>
            </p>
            <div class="grant-item__owner">
              <div class="d-flex">
                <span class="grant-item__owner-handle font-smaller-3">{% trans 'by' %}</span>
                <a :href="grant.admin_profile.url" :data-usercard="grant.admin_profile.handle" target="_blank" rel="noopener noreferrer">
                  <div class="d-flex align-center">
                    <div class="grant-item__owner-image ml-2">
                      <img :src="grant.admin_profile.avatar_url || 'https://c.gitcoin.co/avatars/57e79c0ae763bb27095f6b265a1a8bf3/thelostone-mc.svg'">
                    </div>
                    <div class="grant-item__owner-handle font-smaller-3">
                      <span class="ml-2">
                        [[ grant.admin_profile.handle || 'anonymous' ]]
                      </span>
                    </div>
                  </div>
                </a>
              </div>
              <div class="d-flex match ml-3">
                <div class="match__round--inline mr-3">
                  <template v-if="grant.is_clr_eligible">
                    <span class="font-subheader font-weight-bold amount pt-1 mb-2">
                      [[ get_clr_prediction(0, 1) || 0  | round | formatNumber ]] DAI
                    </span>
                    <span class="amount mb-2 font-smaller-3">
                      Final CLR Match
                    </span>
                  </template>
                  <template v-else>
                    <span class="font-subheader font-weight-bold amount pt-1 mb-2">
                      [[ grant.amount_received || 0 | round | formatNumber ]] DAI
                    </span>
                    <span class="amount mb-2 font-smaller-3">All Time Funding</span>
                  </template>
                </div>
                <div>
                  <span class="font-subheader font-weight-bold amount pt-1 mb-2">
                    [[ grant.amount_received_in_round || 0 | round | formatNumber ]] DAI
                  </span>
                  <span class="amount mb-2 font-smaller-3">
                    raised from
                  </span>
                  <span class="amount mb-2 font-smaller-3 font-weight-semibold">
                   [[ grant.positive_round_contributor_count ]] contributors
                  </span>
                </div>
              </div>
              <template v-if="cred.is_authenticated">
                <button @click="toggleFollowingGrant(grant.id, $event)" :class="`ml-3 text-decoration-none btn btn-link star-action m-0 p-0 font-smaller-3 gc-text-blue ${!grant.favorite ? 'text-muted' : ''}`" :data-grant="grant.id">
                  <i :class="`${!grant.favorite ? 'far' : 'fa' } fa-star`" ></i>
                  <span class="ml-1 font-body">[[ !grant.favorite ? 'Follow' : 'Following' ]]</span>
                </button>
              </template>
            </div>
          </div>
        </div>
        <div class="col-md-3 col-sm-12 py-4 pr-md-5 pl-md-0 grant-action">
          <form class="js-addDetailToCart-form" v-if="!grant.is_on_team">
            {% include 'grants/components/hidden_inputs.html' %}
            <button class="btn btn-gc-blue cart-btn large font-body font-weight-semibold mt-1 mr-1">
              + Add to Cart
            </button>
          </form>
          <button class="btn btn-gc-grey cart-btn large font-body font-weight-semibold mt-1 mr-1" v-else>
            <i class="fa fa-stop" aria-hidden="true"></i> Cannot Fund your Own Grant
          </button>
        </div>
      </div>
      <div style="background-color: #FAFAFA">
        <div class="clr col-12 mb-3" v-if="show_contributions">
          <div :class="`match__round pb-1 pt-2 ${ (index + 1) % 2 === 0  ? 'no-bg' : ''}`" v-for="(contribution, index) in getContributions(grant.id)">
            <p class="col-12 amount mb-2 font-caption font-weight-semibold"> [[ index + 1 ]]. Contributed
              <span class="font-weight-bold">[[ contribution.amount_per_period ]] [[ contribution.token_symbol ]]</span> at [[ contribution.created_on ]].
            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="grant-item" v-else>
      <div class="grant-item__img">
        <img :src="grant.logo_url">
      </div>
      <div class="grant-item__content px-3">
        <h2 class="grant-item__title font-subheader">
          <a :href="grant.details_url">[[ grant.title.slice(0,60) ]][[ grant.title.length > 60 ? '...' : '']]</a>
        </h2>
        <p class="grant-item__pitch font-caption mb-2">[[ grant.description.slice(0, 145) ]][[ grant.description.length > 145 ? '...' : '']]</p>
        <p class="grant-item__pitch font-caption mb-0" style="height:2rem;"  data-toggle="tooltip" data-placement="top" title="The last time the grant admin updated the grant." >
          <span class="font-smaller-5">
            <i style="width: 14px;" class="fas fa-clock mt-2 mb-0 text-center"></i>
            Last Update: [[ grant.last_update ?  grant.last_update_natural : `Before Round` ]]
          </span>
        </p>
        <template v-if="cred.is_staff">
          <hr class="my-2">
          <p class="font-caption font-weight-semibold">
            <i class="fa fa-lock mr-2" aria-hidden="true"></i>
            SybilScore ™️: [[ grant.sybil_score ]]
            <span class="mx-2">|</span>
            RiskScore ™️: [[ grant.weighted_risk_score ]]
          </p>
        </template>

        <div class="grant-item__owner my-3 justify-content-between">
          <div>
            <a :href="grant.admin_profile.url" :data-usercard="grant.admin_profile.handle" target="_blank" rel="noopener noreferrer">
              <div class="grant-item__owner">
                <span class="grant-item__owner-handle font-body">By</span>
                <div v-if="grant.admin_profile.avatar_url" class="grant-item__owner-image mx-2">
                  <img :src="grant.admin_profile.avatar_url">
                </div>
                <div class="grant-item__owner-handle font-smaller-2">
                  [[ grant.admin_profile.handle]]
                </div>
              </div>
            </a>
          </div>
          <template v-if="cred.is_authenticated">
            <button @click="toggleFollowingGrant(grant.id, $event)" :class="`text-decoration-none btn btn-link star-action m-0 p-0 mr-4 gc-text-blue ${!grant.favorite ? 'text-muted' : ''}`" :data-grant="grant.id">
              <i :class="`${!grant.favorite ? 'far' : 'fa' } fa-star`" ></i>
              <span class="ml-1 font-body">[[ !grant.favorite ? 'Follow' : 'Following' ]]</span>
            </button>
          </template>
        </div>
      </div>
      <div class="grant-item__footer">
          <div class="clr mb-3">
            <div class="match__round pb-1 pt-2 mb-2">
              <h2 class="title col-8 font-caption g-bold" v-if="grant.clr_round_num">
                [[grant.clr_round_num]] CLR MATCH ROUND
              </h2>
            </div>
            <div class="col-6 float-right px-0">
              <h2 class="font-title font-weight-bold amount pt-1 mb-2">
                [[ grant.amount_received_in_round || 0 | round | formatNumber ]] DAI
              </h2>
              <p class="amount mb-2 font-caption font-weight-semibold">
                raised from [[ grant.positive_round_contributor_count ]] contributors
              </p>
            </div>
            <div class="col-6">

              <template v-if="grant.is_clr_eligible">
                <h2 class="font-title font-weight-bold amount pt-1 mb-2">
                  [[ get_clr_prediction(0, 1) || 0  | round | formatNumber ]] DAI
                </h2>
                <p class="amount mb-2 font-caption font-weight-semibold">
                  Final CLR Match
                </p>
              </template>
              <template v-else>
                <h2 class="font-title font-weight-bold amount pt-1 mb-2">
                  [[ grant.amount_received || 0 | round | formatNumber ]] DAI
                </h2>
                <p class="amount mb-2 font-caption font-weight-semibold">All Time Funding</p>
              </template>
            </div>
          </div>

          <template v-if="grant.is_clr_active">
            <div class="col-12 pb-3" v-if="grant.is_clr_eligible">
              {% include 'grants/components/clr_estimate.html' %}
            </div>
            <h2 class="font-subheader text-center amount pt-4 mb-3" style="color:#069953" v-else>
              NOT ELIGIBLE FOR CLR
            </h2>
          </template>

          <div class="col-12 pb-4">
            <form class="js-addDetailToCart-form" v-if="!grant.is_on_team">
              {% include 'grants/components/hidden_inputs.html' %}
              <button class="btn btn-gc-blue cart-btn large font-body font-weight-semibold mt-1 mr-1">
                + Add to Cart
              </button>
            </form>

            <button class="btn btn-gc-grey cart-btn large font-body font-weight-semibold mt-1 mr-1" v-else>
              <i class="fa fa-stop" aria-hidden="true"></i> Cannot Fund your Own Grant
            </button>
          </div>

          <div class="clr mb-3" v-if="show_contributions">
            <div :class="`match__round pb-1 pt-2 ${ (index + 1) % 2 === 0  ? 'no-bg' : ''}`" v-for="(contribution, index) in getContributions(grant.id)">
              <p class="col-12 amount mb-2 font-caption font-weight-semibold"> [[ index + 1 ]]. Contributed
                <span class="font-weight-bold">[[ contribution.amount_per_period ]] [[ contribution.token_symbol ]]</span> at [[ contribution.created_on ]].
              </p>
            </div>
          </div>

      </div>
    </div>
  </template>
</grant-card>
